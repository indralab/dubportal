{% extends "base.html" %}

{% block title %}DUB portal{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        $(document).ready(function () {
            $("#table-terms").DataTable();
            $("#gsea-enrichment").DataTable();
        })
    </script>
{% endblock %}

{% block content %}
    <h1 align="center">Dependencies of {{ record.hgnc_symbol }}</h1>
    <dl>
        <dt>HGNC Gene Name</dt>
        <dd>{{ record.description }}</dd>
        <dt>HGNC Gene Symbol</dt>
        <dd>{{ record.hgnc_symbol }}</dd>
        <dt>HGNC Identifier</dt>
        <dd><a href="https://bioregistry.io/hgnc:{{ record.hgnc_id }}">HGNC:{{ record.hgnc_id }}<a/></dd>
        <dt>UniProt Identifier</dt>
        <dd><a href="https://bioregistry.io/uniprot:{{ record.uniprot_id }}">{{ record.uniprot_id }}<a/></dd>
        <dt>Entrez Gene Identifier</dt>
        <dd><a href="https://bioregistry.io/ncbigene:{{ record.entrez_id }}">{{ record.entrez_id }}<a/></dd>
        {% if record.mgi_id %}
            <dt>Mouse Gene Identifier</dt>
            <dd><a href="https://bioregistry.io/mgi:{{ record.mgi_id }}">MGI:{{ record.mgi_id }}<a/></dd>
        {% endif %}
        {% if record.rgd_id %}
            <dt>Rat Gene Identifier</dt>
            <dd><a href="https://bioregistry.io/rgd:{{ record.rgd_id }}">RGD:{{ record.rgd_id }}<a/></dd>
        {% endif %}
        <dt>NDEx Network</dt>
        <dd><a href="https://bioregistry.io/ndex:{{ ndex }}">{{ ndex }}</a></dd>
        <dt>Number of Papers</dt>
        <dd>{{ record.papers }}</dd>
        <dt>RNASeq</dt>
        <dd>{{ record.rnaseq }}</dd>
    </dl>
    <h2>DepMap Correlation Analysis</h2>
    <p>
        TODO Laura: add text here explaining how this was done
    </p>
    <table class="table table-striped table-hover" id="table-terms">
        <thead>
        <tr style="text-align: right;">
            <th>Name</th>
            <th align="right">DepMap Correlation</th>
            <th align="right">CCLE Correlation</th>
            <th align="right">CCLE Z-score</th>
            <th align="right">CCLE <i>p</i>-value (adj)</th>
            <th align="right">CCLE Significant</th>
            <th align="right">CMAP Score</th>
            <th>CMAP Type</th>
        </tr>
        </thead>
        <tbody>
        {% for row in record.depmap %}
            <tr>
                <td>
                    <a data-toggle="tooltip" data-html="true" title="HGNC:{{ row.hgnc_id }}"
                       href="https://bioregistry.io/hgnc:{{ row.hgnc_id }}">
                        {{ row.hgnc_symbol }}
                    </a>
                </td>
                <td align="right">{{ row.correlation }}</td>
                {% if row.ccle %}
                    <td align="right">{{ "%.2f" | format(row.ccle.correlation) }}</td>
                    <td align="right">{{ "%.2f" | format(row.ccle.z) }}</td>
                    <td align="right">{{ "%.2e" | format(row.ccle.p_adj) }}</td>
                    <td align="right">
                        {% if row.ccle.significant %}
                            <span style="color: green;"><i class="fas fa-check-circle"></i></span>
                        {% else %}
                            <span style="color: red;"><i class="fas fa-times-circle"></i></span>
                        {% endif %}
                    </td>
                {% else %}
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                {% endif %}
                {% if row.cmap %}
                    <td align="right">{{ "%.2f" | format(row.cmap.score) }}</td>
                    <td align="right">{{ row.cmap.type }}</td>
                {% else %}
                    <td></td>
                    <td></td>
                {% endif %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <h2>GSEA Results</h2>
    <p>
        Gene set enrichment analysis was done on the genes correlated with {{ record.hgnc_symbol }}
        using the terms from <a href="http://geneontology.org/">Gene Ontology</a> and gene sets derived from the
        <a href="http://geneontology.org/docs/go-annotations/">Gene Ontology Annotations database</a>
        via <a href="https://www.gsea-msigdb.org/gsea/msigdb/index.jsp">MSigDB</a>.
    </p>
    <table class="table table-striped table-hover" id="gsea-enrichment">
        <thead>
        <tr style="text-align: right;">
            <th>Name</th>
            <th align="right"><i>p</i>-value</th>
            <th align="right"><i>p</i>-value (adj.)</th>
            <th align="right"><i>q</i>-value</th>
        </tr>
        </thead>
        <tbody>
        {% for row in record.go %}
            <tr>
                <td>
                    <a data-toggle="tooltip" data-html="true" title="{{ row.identifier }}"
                       href="https://bioregistry.io/{{ row.identifier }}">
                        {{ row.name }}
                    </a>
                </td>
                <td align="right">{{ row.p }}</td>
                <td align="right">{{ row.p_adj }}</td>
                <td align="right">{{ row.q }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}
