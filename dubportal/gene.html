{% extends "base.html" %}

{% block title %}DUB Portal{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        $(document).ready(function () {
            $("#table-terms").DataTable();
            $("#gsea-enrichment").DataTable();
        })
    </script>
{% endblock %}

{% macro boolbox(value) -%}
    {% if value %}
        <span style="color: green;"><i class="fas fa-check-circle"></i></span>
    {% else %}
        <span style="color: red;"><i class="fas fa-times-circle"></i></span>
    {% endif %}
{%- endmacro %}

{% block content %}
    <h1>
        <a href="/"><i class="fas fa-home"></i></a> <small><i class="fas fa-chevron-right"></i></small>
        Dependencies of {{ record.hgnc_symbol }}
    </h1>
    <dl class="row">
        <dt class="col-4">HGNC Gene Name</dt>
        <dd class="col-8">{{ record.hgnc_name }}</dd>
        <dt class="col-4">HGNC Gene Symbol</dt>
        <dd class="col-8">{{ record.hgnc_symbol }}</dd>
        <dt class="col-4">Identifiers</dt>
        <dd class="col-8">
            <a class="badge badge-info"
               href="https://bioregistry.io/hgnc:{{ record.hgnc_id }}">hgnc:{{ record.hgnc_id }}</a>
            <a class="badge badge-info"
               href="https://bioregistry.io/ncbigene:{{ record.entrez_id }}">ncbigene:{{ record.entrez_id }}</a>
            <a class="badge badge-info"
               href="https://bioregistry.io/uniprot:{{ record.uniprot_id }}">uniprot:{{ record.uniprot_id }}</a>
        </dd>
        {% if record.mgi_id or record.rgd_id %}
            <dt class="col-4">Orthologs</dt>
            <dd class="col-8">
                {% if record.rgd_id %}
                    <a class="badge badge-info"
                       href="https://bioregistry.io/mgi:{{ record.mgi_id }}">mgi:{{ record.mgi_id }}</a>
                {% endif %}
                {% if record.rgd_id %}
                    <a class="badge badge-info"
                       href="https://bioregistry.io/rgd:{{ record.rgd_id }}">rgd:{{ record.rgd_id }}</a>
                {% endif %}
            </dd>
        {% endif %}
        <dt class="col-4">NDEx Network</dt>
        <dd class="col-8"><a href="https://bioregistry.io/ndex:{{ ndex }}">{{ ndex }}</a></dd>
        {#        <dt class="col-4">Number of Papers</dt>#}
        {#        <dd class="col-8">{{ record.papers }}</dd>#}
        {#        <dt class="col-4">RNASeq</dt>#}
        {#        <dd class="col-8">{{ record.rnaseq }}</dd>#}
    </dl>
    <h2>DepMap Correlation Analysis</h2>
    <p>
        TODO Laura: add text here explaining how this was done
    </p>
    <table class="table table-striped table-hover" id="table-terms">
        <thead>
        <tr style="text-align: right;">
            <th>Symbol</th>
            <th>Name</th>
            <th align="right">DepMap Correlation</th>
            <th align="right">BioGRID</th>
            <th align="right">IntAct</th>
            <th align="right">NURSA</th>
            <th align="right">PC</th>
            <th align="right">PPID</th>
            <th align="right">CCLE Correlation</th>
            <th align="right">CCLE Z-score</th>
            <th align="right">CCLE <i>p</i>-value (adj)</th>
            <th align="right">CCLE Significant</th>
            <th align="right">CMAP Score</th>
            <th>CMAP Type</th>
        </tr>
        </thead>
        <tbody>
        {% for row in record.depmap %}
            <tr>
                <td>
                    <a data-toggle="tooltip" data-html="true" title="HGNC:{{ row.hgnc_id }}"
                       href="https://bioregistry.io/hgnc:{{ row.hgnc_id }}">
                        {{ row.hgnc_symbol }}
                    </a>
                </td>
                <td>{{ row.hgnc_name }}</td>
                <td align="right">{{ row.correlation }}</td>
                <td>{{ boolbox(row.interactions.biogrid) }}</td>
                <td>{{ boolbox(row.interactions.intact) }}</td>
                <td>{{ boolbox(row.interactions.nursa) }}</td>
                <td>{{ boolbox(row.interactions.pc) }}</td>
                <td>{{ boolbox(row.interactions.ppid) }}</td>
                {% if row.ccle %}
                    <td align="right">{{ "%.2f" | format(row.ccle.correlation) }}</td>
                    <td align="right">{{ "%.2f" | format(row.ccle.z) }}</td>
                    <td align="right">{{ "%.2e" | format(row.ccle.p_adj) }}</td>
                    <td align="right">
                        {% if row.ccle.significant %}
                            <span style="color: green;"><i class="fas fa-check-circle"></i></span>
                        {% else %}
                            <span style="color: red;"><i class="fas fa-times-circle"></i></span>
                        {% endif %}
                    </td>
                {% else %}
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                {% endif %}
                {% if row.cmap %}
                    <td align="right">{{ "%.2f" | format(row.cmap.score) }}</td>
                    <td align="right">{{ row.cmap.type }}</td>
                {% else %}
                    <td></td>
                    <td></td>
                {% endif %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <h2>GSEA Results</h2>
    <p>
        Gene set enrichment analysis was done on the genes correlated with {{ record.hgnc_symbol }}
        using the terms from <a href="http://geneontology.org/">Gene Ontology</a> and gene sets derived from the
        <a href="http://geneontology.org/docs/go-annotations/">Gene Ontology Annotations database</a>
        via <a href="https://www.gsea-msigdb.org/gsea/msigdb/index.jsp">MSigDB</a>.
    </p>
    <table class="table table-striped table-hover" id="gsea-enrichment">
        <thead>
        <tr style="text-align: right;">
            <th>Name</th>
            <th align="right"><i>p</i>-value</th>
            <th align="right"><i>p</i>-value (adj.)</th>
            <th align="right"><i>q</i>-value</th>
        </tr>
        </thead>
        <tbody>
        {% for row in record.go %}
            <tr>
                <td>
                    <a data-toggle="tooltip" data-html="true" title="{{ row.identifier }}"
                       href="https://bioregistry.io/{{ row.identifier }}">
                        {{ row.name }}
                    </a>
                </td>
                <td align="right">{{ "%.2e" | format(row.p) }}</td>
                <td align="right">{{ "%.2e" | format(row.p_adj) }}</td>
                <td align="right">{{ "%.2e" | format(row.q) }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}
